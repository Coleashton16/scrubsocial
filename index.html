<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Scrubs Social</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* Mobile Optimization Overrides */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none; /* Prevent rubber-banding */
            user-select: none;
        }

        /* Safe Area Padding for iPhones */
        .pt-safe { padding-top: env(safe-area-inset-top, 20px); }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom, 20px); }

        /* Hide Scrollbar */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Smooth Transitions */
        .transition-all-300 { transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1); }

        /* Loading Spinner */
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #14b8a6;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Auth Screen Background */
        .auth-bg {
            background-image: linear-gradient(135deg, #f0f9ff 0%, #cbebff 100%);
        }
        
        input:focus { outline: none; border-color: #14b8a6; ring: 2px; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 h-screen flex flex-col overflow-hidden">

    <!-- ================= AUTH SCREEN ================= -->
    <div id="auth-screen" class="fixed inset-0 z-50 auth-bg flex flex-col items-center justify-center p-6 hidden">
        <div class="w-full max-w-sm bg-white rounded-3xl shadow-xl p-8 transition-all-300">
            <div class="flex justify-center mb-6">
                <div class="w-16 h-16 bg-teal-500 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-teal-500/30">
                    <i data-lucide="activity" width="32" height="32"></i>
                </div>
            </div>
            <h1 class="text-2xl font-bold text-center text-slate-800 mb-2">Scrubs Social</h1>
            <p class="text-center text-slate-500 text-sm mb-8">The shift log for nurses.</p>

            <!-- Error Message -->
            <div id="auth-error" class="hidden bg-red-50 text-red-500 text-xs p-3 rounded-lg mb-4 text-center"></div>

            <!-- Login Form -->
            <div id="login-form">
                <input type="email" id="login-email" placeholder="Email" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 mb-3 text-sm font-medium focus:ring-2 focus:ring-teal-500 outline-none transition-all">
                <input type="password" id="login-password" placeholder="Password" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 mb-4 text-sm font-medium focus:ring-2 focus:ring-teal-500 outline-none transition-all">
                <button id="btn-login" class="w-full bg-slate-900 text-white rounded-xl py-3.5 font-bold shadow-lg active:scale-95 transition-transform">Log In</button>
                
                <div class="relative my-6">
                    <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-slate-200"></div></div>
                    <div class="relative flex justify-center text-xs uppercase"><span class="bg-white px-2 text-slate-400">Or</span></div>
                </div>

                <button id="btn-google" class="w-full bg-white border border-slate-200 text-slate-700 rounded-xl py-3.5 font-bold shadow-sm flex items-center justify-center gap-2 active:scale-95 transition-transform hover:bg-slate-50">
                    <svg class="w-5 h-5" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.84z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                    Continue with Google
                </button>

                <p class="text-center mt-6 text-sm text-slate-500">
                    New here? <button id="switch-to-signup" class="text-teal-600 font-bold hover:underline">Create Account</button>
                </p>
            </div>

            <!-- Signup Form -->
            <div id="signup-form" class="hidden">
                <div class="flex gap-2 mb-3">
                    <input type="text" id="signup-name" placeholder="Display Name" class="w-1/2 bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-sm font-medium focus:ring-2 focus:ring-teal-500 outline-none">
                    <select id="signup-role" class="w-1/2 bg-slate-50 border border-slate-200 rounded-xl px-2 py-3 text-sm font-medium focus:ring-2 focus:ring-teal-500 outline-none text-slate-600">
                        <option value="RN">RN</option>
                        <option value="LPN">LPN</option>
                        <option value="Student">Student</option>
                        <option value="CNA">CNA</option>
                        <option value="MD/DO">MD/DO</option>
                        <option value="Tech">Tech</option>
                    </select>
                </div>
                <input type="email" id="signup-email" placeholder="Email" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 mb-3 text-sm font-medium focus:ring-2 focus:ring-teal-500 outline-none">
                <input type="password" id="signup-password" placeholder="Password (6+ chars)" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 mb-4 text-sm font-medium focus:ring-2 focus:ring-teal-500 outline-none">
                
                <button id="btn-signup" class="w-full bg-teal-600 text-white rounded-xl py-3.5 font-bold shadow-lg active:scale-95 transition-transform">Create Account</button>
                
                <p class="text-center mt-6 text-sm text-slate-500">
                    Have an account? <button id="switch-to-login" class="text-slate-900 font-bold hover:underline">Log In</button>
                </p>
            </div>
        </div>
    </div>

    <!-- ================= APP CONTAINER ================= -->
    <div id="app-container" class="flex flex-col h-full hidden">
        
        <!-- Header -->
        <header class="bg-white/90 backdrop-blur-md border-b border-gray-100 z-40 transition-all sticky top-0">
            <div class="pt-safe px-4 pb-3 flex justify-between items-center">
                <h1 class="text-xl font-bold tracking-tight text-slate-900 flex items-center gap-2">
                    <div class="w-8 h-8 bg-teal-500 rounded-lg flex items-center justify-center text-white shadow-sm">
                        <i data-lucide="activity" width="18"></i>
                    </div>
                    Scrubs
                </h1>
                <button id="btn-logout" class="w-9 h-9 rounded-full bg-slate-100 flex items-center justify-center border border-slate-200 text-slate-600 active:scale-90 transition-transform">
                    <i data-lucide="log-out" width="16"></i>
                </button>
            </div>

            <!-- Vibe Board -->
            <div class="px-4 pb-3">
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">Shift Vibe</p>
                <div class="flex gap-3 overflow-x-auto no-scrollbar" id="vibe-board">
                    <!-- Vibes injected by JS -->
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main id="main-content" class="flex-1 overflow-y-auto pb-safe scroll-smooth bg-slate-50 relative">
            <div id="feed-container" class="pb-32 min-h-full">
                <!-- Posts injected by JS -->
                <div class="flex justify-center pt-20">
                    <div class="loader"></div>
                </div>
            </div>

            <!-- Search View (Hidden by default) -->
            <div id="search-view" class="hidden pt-10 px-6 text-center min-h-full bg-slate-50">
                <i data-lucide="search" class="mx-auto text-slate-300 mb-4" width="48"></i>
                <h2 class="text-lg font-bold text-slate-400">Search Coming Soon</h2>
                <p class="text-sm text-slate-400 mt-2">Filter the feed feature is in development.</p>
                <button onclick="switchTab('home')" class="mt-6 text-teal-600 font-bold text-sm">Back to Feed</button>
            </div>

             <!-- Saved View (Hidden by default) -->
             <div id="saved-view" class="hidden pt-10 px-6 text-center min-h-full bg-slate-50">
                <i data-lucide="bookmark" class="mx-auto text-slate-300 mb-4" width="48"></i>
                <h2 class="text-lg font-bold text-slate-400">Saved Posts</h2>
                <p class="text-sm text-slate-400 mt-2">Your collection will appear here.</p>
            </div>

            <!-- Profile View (Hidden by default) -->
            <div id="profile-view" class="hidden pt-10 px-4 min-h-full bg-slate-50">
                <div class="text-center mb-8">
                    <div id="profile-avatar" class="w-24 h-24 rounded-full bg-teal-100 mx-auto mb-4 border-4 border-white shadow-sm flex items-center justify-center text-3xl font-bold text-teal-600">
                        <!-- Initials -->
                    </div>
                    <h2 id="profile-name" class="text-xl font-bold text-slate-900"></h2>
                    <p id="profile-role" class="text-slate-400 font-medium"></p>
                    <p id="profile-email" class="text-xs text-slate-300 mt-1"></p>
                </div>
                <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100">
                    <h3 class="text-sm font-bold text-slate-800 mb-4 border-b border-slate-100 pb-2">Stats</h3>
                    <div class="flex justify-between text-center">
                        <div class="flex-1">
                            <div class="text-lg font-bold text-slate-900" id="stat-posts">0</div>
                            <div class="text-xs text-slate-400">Posts</div>
                        </div>
                        <div class="flex-1 border-l border-slate-100">
                            <div class="text-lg font-bold text-slate-900">0</div>
                            <div class="text-xs text-slate-400">Likes</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Create Post Modal -->
        <div id="create-modal" class="fixed inset-0 z-[60] bg-slate-900/50 backdrop-blur-sm hidden flex flex-col justify-end sm:justify-center items-center transition-all">
            <div class="bg-white w-full max-w-md rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl animate-slide-up">
                <div class="flex justify-between items-center mb-4">
                    <button id="close-create" class="text-slate-400 hover:text-slate-600">Cancel</button>
                    <h3 class="font-bold text-lg">New Post</h3>
                    <button id="btn-submit-post" class="text-teal-600 font-bold disabled:opacity-50">Post</button>
                </div>
                
                <textarea id="post-content" class="w-full h-32 resize-none outline-none text-lg placeholder:text-slate-300" placeholder="What's happening on your shift?"></textarea>
                
                <div class="border-t border-slate-100 pt-4 mt-2">
                    <label class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 block">Image URL (Optional)</label>
                    <div class="flex gap-2">
                        <input type="text" id="post-image" placeholder="https://..." class="flex-1 bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-sm outline-none focus:border-teal-500">
                    </div>
                </div>
            </div>
        </div>

        <!-- Floating Nav -->
        <div class="fixed bottom-6 left-0 right-0 flex justify-center z-50 pointer-events-none pb-safe">
            <div id="nav-dock" class="bg-slate-900 shadow-2xl transition-all-300 pointer-events-auto flex items-center overflow-hidden w-14 h-14 rounded-full justify-center cursor-pointer">
                <!-- Collapsed State Icon -->
                <div id="nav-menu-icon" class="text-white">
                    <i data-lucide="menu" width="24"></i>
                </div>

                <!-- Expanded Items (Hidden initially) -->
                <div id="nav-items" class="hidden w-full h-full flex items-center justify-between px-2">
                    <button onclick="switchTab('home')" class="nav-btn flex-1 flex justify-center text-teal-400" data-target="home"><i data-lucide="home" width="20"></i></button>
                    <button onclick="switchTab('search')" class="nav-btn flex-1 flex justify-center text-slate-400" data-target="search"><i data-lucide="search" width="20"></i></button>
                    <button id="btn-create" class="flex-1 flex justify-center text-white">
                        <div class="bg-teal-500 w-10 h-10 rounded-full flex items-center justify-center shadow-lg shadow-teal-500/20"><i data-lucide="plus" width="22"></i></div>
                    </button>
                    <button onclick="switchTab('saved')" class="nav-btn flex-1 flex justify-center text-slate-400" data-target="saved"><i data-lucide="bookmark" width="20"></i></button>
                    <button onclick="switchTab('profile')" class="nav-btn flex-1 flex justify-center text-slate-400" data-target="profile"><i data-lucide="user" width="20"></i></button>
                    <button id="close-nav" class="w-8 flex justify-center text-slate-500"><i data-lucide="x" width="18"></i></button>
                </div>
            </div>
        </div>

    </div>

    <!-- ================= JAVASCRIPT LOGIC ================= -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { 
            getAuth, 
            signInWithPopup, 
            GoogleAuthProvider, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            onAuthStateChanged,
            signOut,
            updateProfile
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            query, 
            orderBy, 
            onSnapshot, 
            serverTimestamp,
            updateDoc,
            doc,
            arrayUnion,
            arrayRemove,
            setDoc,
            getDoc
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // --- Firebase Config ---
        const firebaseConfig = {
            apiKey: "AIzaSyAuc1G9CwL3uLdEXcQ1Osu1VAqax5QVlnA",
            authDomain: "scrubsocial-de5cf.firebaseapp.com",
            projectId: "scrubsocial-de5cf",
            storageBucket: "scrubsocial-de5cf.firebasestorage.app",
            messagingSenderId: "87542166167",
            appId: "1:87542166167:web:20e1272374577e14fcefd2"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        // --- State ---
        let currentUser = null;
        let currentUserData = null; // From Firestore users collection

        // --- Auth Logic ---
        
        // Listener
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                // Fetch extra user data (Role)
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if(userDoc.exists()) {
                    currentUserData = userDoc.data();
                } else {
                    // Create default if logging in via Google for first time
                    currentUserData = {
                        role: 'RN',
                        displayName: user.displayName || 'Nurse',
                        email: user.email,
                        photoURL: user.photoURL
                    };
                    await setDoc(doc(db, "users", user.uid), currentUserData);
                }

                showApp();
                initFeed();
                updateProfileUI();
            } else {
                currentUser = null;
                currentUserData = null;
                showAuth();
            }
        });

        // Sign Up
        document.getElementById('btn-signup').addEventListener('click', async () => {
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const name = document.getElementById('signup-name').value;
            const role = document.getElementById('signup-role').value;

            if(!email || !password || !name) return showError('Please fill all fields');

            try {
                const cred = await createUserWithEmailAndPassword(auth, email, password);
                await updateProfile(cred.user, { displayName: name });
                // Store Role in Firestore
                await setDoc(doc(db, "users", cred.user.uid), {
                    role: role,
                    displayName: name,
                    email: email,
                    photoURL: null
                });
            } catch (error) {
                showError(error.message);
            }
        });

        // Login
        document.getElementById('btn-login').addEventListener('click', async () => {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            if(!email || !password) return showError('Please enter email and password');

            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                showError('Invalid email or password.');
            }
        });

        // Google Login
        document.getElementById('btn-google').addEventListener('click', async () => {
            try {
                await signInWithPopup(auth, googleProvider);
            } catch (error) {
                showError(error.message);
            }
        });

        // Logout
        document.getElementById('btn-logout').addEventListener('click', () => signOut(auth));

        // Toggle Auth Forms
        document.getElementById('switch-to-signup').addEventListener('click', () => {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('signup-form').classList.remove('hidden');
            document.getElementById('auth-error').classList.add('hidden');
        });
        document.getElementById('switch-to-login').addEventListener('click', () => {
            document.getElementById('signup-form').classList.add('hidden');
            document.getElementById('login-form').classList.remove('hidden');
            document.getElementById('auth-error').classList.add('hidden');
        });

        // --- UI Logic ---

        function showAuth() {
            document.getElementById('auth-screen').classList.remove('hidden');
            document.getElementById('app-container').classList.add('hidden');
        }

        function showApp() {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('app-container').classList.remove('hidden');
        }

        function showError(msg) {
            const el = document.getElementById('auth-error');
            el.innerText = msg;
            el.classList.remove('hidden');
        }

        function updateProfileUI() {
            if(!currentUser) return;
            document.getElementById('profile-name').innerText = currentUserData.displayName || "User";
            document.getElementById('profile-role').innerText = currentUserData.role || "RN";
            document.getElementById('profile-email').innerText = currentUser.email;
            
            // Avatar
            const avatarEl = document.getElementById('profile-avatar');
            if(currentUser.photoURL) {
                avatarEl.innerHTML = `<img src="${currentUser.photoURL}" class="w-full h-full rounded-full object-cover">`;
            } else {
                avatarEl.innerText = (currentUserData.displayName || "U").charAt(0).toUpperCase();
            }
        }

        // --- Feed Logic ---
        
        function initFeed() {
            const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
            
            onSnapshot(q, (snapshot) => {
                const container = document.getElementById('feed-container');
                container.innerHTML = ''; // Clear loading
                
                // Update profile stats
                document.getElementById('stat-posts').innerText = snapshot.size;

                snapshot.forEach((doc) => {
                    const post = doc.data();
                    const el = createPostElement(doc.id, post);
                    container.appendChild(el);
                });
                
                lucide.createIcons(); // Re-render icons
            });
        }

        function createPostElement(id, post) {
            const isLiked = post.likes && post.likes.includes(currentUser.uid);
            const likeCount = post.likes ? post.likes.length : 0;
            
            // Time calc
            const date = post.createdAt ? post.createdAt.toDate() : new Date();
            const timeDiff = Math.round((new Date() - date) / 1000 / 60); // minutes
            let timeStr = timeDiff + 'm ago';
            if (timeDiff > 60) timeStr = Math.round(timeDiff/60) + 'h ago';
            
            const div = document.createElement('div');
            div.className = "mb-4 bg-white border-b border-gray-100 pb-4 animate-fade-in";
            div.innerHTML = `
                <div class="px-4 py-3 flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="relative">
                            ${post.authorPhoto 
                                ? `<img src="${post.authorPhoto}" class="w-10 h-10 rounded-full object-cover border border-gray-100">`
                                : `<div class="w-10 h-10 rounded-full bg-teal-100 flex items-center justify-center text-teal-700 font-bold">${post.authorName[0]}</div>`
                            }
                            <div class="absolute -bottom-1 -right-1 bg-teal-500 text-[9px] text-white px-1.5 py-0.5 rounded-full border border-white font-bold">
                                ${post.authorRole || 'RN'}
                            </div>
                        </div>
                        <div>
                            <h3 class="text-sm font-bold text-slate-900">${post.authorName}</h3>
                            <p class="text-xs text-slate-400">${timeStr}</p>
                        </div>
                    </div>
                </div>

                ${post.image ? 
                    `<div class="relative w-full bg-gray-100 mb-3">
                        <img src="${post.image}" class="w-full h-auto object-cover max-h-[500px]" loading="lazy">
                    </div>` 
                    : 
                    `<div class="mx-4 rounded-2xl p-6 bg-gradient-to-br from-indigo-500 to-purple-600 text-white shadow-sm min-h-[160px] flex items-center justify-center text-center mb-3">
                         <p class="text-lg font-medium leading-relaxed">${post.content}</p>
                    </div>`
                }

                ${post.image ? 
                    `<div class="px-4 mb-3">
                        <p class="text-sm text-slate-800 leading-relaxed">
                            <span class="font-bold mr-2">${post.authorName}</span>
                            ${post.content}
                        </p>
                    </div>` : ''
                }

                <div class="px-4 flex items-center gap-6">
                    <button class="flex items-center gap-2 group active:scale-95 transition-transform btn-like" data-id="${id}">
                        <i data-lucide="heart" class="w-6 h-6 ${isLiked ? 'text-red-500 fill-red-500' : 'text-slate-800'} transition-colors"></i>
                        <span class="text-sm font-bold text-slate-800">${likeCount}</span>
                    </button>
                    <button class="flex items-center gap-2 group active:scale-95 transition-transform">
                        <i data-lucide="message-circle" class="w-6 h-6 text-slate-800"></i>
                        <span class="text-sm font-bold text-slate-800">0</span>
                    </button>
                    <div class="flex-1"></div>
                    <button class="text-slate-800 active:scale-90 transition-transform">
                        <i data-lucide="share-2" class="w-6 h-6"></i>
                    </button>
                </div>
            `;
            
            // Attach Like Event
            div.querySelector('.btn-like').addEventListener('click', async function() {
                const postRef = doc(db, "posts", this.dataset.id);
                if(isLiked) {
                    await updateDoc(postRef, { likes: arrayRemove(currentUser.uid) });
                } else {
                    await updateDoc(postRef, { likes: arrayUnion(currentUser.uid) });
                }
            });

            return div;
        }

        // --- Create Post Logic ---
        const modal = document.getElementById('create-modal');
        document.getElementById('btn-create').addEventListener('click', () => {
            modal.classList.remove('hidden');
        });
        document.getElementById('close-create').addEventListener('click', () => {
            modal.classList.add('hidden');
        });

        document.getElementById('btn-submit-post').addEventListener('click', async () => {
            const content = document.getElementById('post-content').value;
            const imageUrl = document.getElementById('post-image').value;
            
            if(!content && !imageUrl) return;

            // Close modal immediately for better UX
            modal.classList.add('hidden');
            document.getElementById('post-content').value = '';
            document.getElementById('post-image').value = '';

            try {
                await addDoc(collection(db, "posts"), {
                    authorName: currentUserData.displayName || currentUser.email,
                    authorId: currentUser.uid,
                    authorPhoto: currentUser.photoURL,
                    authorRole: currentUserData.role || 'RN',
                    content: content,
                    image: imageUrl || null,
                    likes: [],
                    createdAt: serverTimestamp()
                });
            } catch (e) {
                console.error("Error adding post: ", e);
                alert("Failed to post. Check console.");
            }
        });

        // --- Navigation Logic ---
        const navDock = document.getElementById('nav-dock');
        const navItems = document.getElementById('nav-items');
        const navMenuIcon = document.getElementById('nav-menu-icon');
        let isNavExpanded = false;

        function toggleNav() {
            isNavExpanded = !isNavExpanded;
            if (isNavExpanded) {
                navDock.classList.remove('w-14', 'h-14', 'rounded-full');
                navDock.classList.add('w-[85%]', 'h-16', 'rounded-[2rem]', 'px-2');
                navMenuIcon.classList.add('hidden');
                setTimeout(() => navItems.classList.remove('hidden'), 100);
            } else {
                navItems.classList.add('hidden');
                navDock.classList.remove('w-[85%]', 'h-16', 'rounded-[2rem]', 'px-2');
                navDock.classList.add('w-14', 'h-14', 'rounded-full');
                setTimeout(() => navMenuIcon.classList.remove('hidden'), 100);
            }
        }

        navDock.addEventListener('click', (e) => {
            if (!isNavExpanded && e.target.closest('#nav-dock')) toggleNav();
        });

        document.getElementById('close-nav').addEventListener('click', (e) => {
            e.stopPropagation();
            toggleNav();
        });

        // Tab Switching
        window.switchTab = (tabId) => {
            // Hide all main content children except the one selected
            document.getElementById('feed-container').classList.add('hidden');
            document.getElementById('search-view').classList.add('hidden');
            document.getElementById('saved-view').classList.add('hidden');
            document.getElementById('profile-view').classList.add('hidden');

            if(tabId === 'home') document.getElementById('feed-container').classList.remove('hidden');
            if(tabId === 'search') document.getElementById('search-view').classList.remove('hidden');
            if(tabId === 'saved') document.getElementById('saved-view').classList.remove('hidden');
            if(tabId === 'profile') document.getElementById('profile-view').classList.remove('hidden');

            // Close nav
            if(isNavExpanded) toggleNav();
            
            // Update active state visuals
            document.querySelectorAll('.nav-btn').forEach(btn => {
                if(btn.dataset.target === tabId) {
                    btn.classList.add('text-teal-400');
                    btn.classList.remove('text-slate-400');
                } else {
                    btn.classList.remove('text-teal-400');
                    btn.classList.add('text-slate-400');
                }
            });
        };

        // --- Vibe Board Logic ---
        const moods = [
            { icon: 'sun', label: "Great", color: "text-orange-500", bg: "bg-orange-50" },
            { icon: 'coffee', label: "Tired", color: "text-amber-700", bg: "bg-amber-100" },
            { icon: 'zap', label: "Manic", color: "text-yellow-600", bg: "bg-yellow-100" },
            { icon: 'cloud-rain', label: "Blue", color: "text-blue-500", bg: "bg-blue-50" },
            { icon: 'frown', label: "Code Brown", color: "text-stone-500", bg: "bg-stone-200" }
        ];

        const vibeBoard = document.getElementById('vibe-board');
        moods.forEach(m => {
            const btn = document.createElement('button');
            btn.className = `flex items-center gap-2 px-4 py-2 rounded-full border border-transparent ${m.bg} ${m.color} active:scale-95 transition-transform whitespace-nowrap shrink-0`;
            btn.innerHTML = `<i data-lucide="${m.icon}" width="16"></i> <span class="text-sm font-bold">${m.label}</span>`;
            vibeBoard.appendChild(btn);
        });
        
        // Initial Render
        lucide.createIcons();

    </script>
</body>
</html>
